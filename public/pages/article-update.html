<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link href="../css/common.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <script type="text/javascript"
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=uxdaz0sqo9"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script>
        const urlSearchParams = new URLSearchParams(window.location.search);
        const params = Object.fromEntries(urlSearchParams.entries());

        $().ready(function () {
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyDKn58QyDMdcfy68EOMON38O_M5Z0N9-pU",
                authDomain: "clean-together-2021.firebaseapp.com",
                databaseURL: "https://clean-together-2021-default-rtdb.firebaseio.com",
                projectId: "clean-together-2021",
                storageBucket: "clean-together-2021.appspot.com",
                messagingSenderId: "299538432144",
                appId: "1:299538432144:web:23c34e489c71aeb8509815",
                measurementId: "G-PJWLYC29GZ"
            };

            // Import the functions you need from the SDKs you need
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries

            // Initialize Firebase
            const app = firebase.initializeApp(firebaseConfig);
            const db = app.database()
            const storage = app.storage()

            $('#step-1-button').click(function () {
                var postListRef = db.ref(`articles/${params.key}/status`).set(1);

                setTimeout(function () {
                    location.href = "./articles.html"
                }, 2000)
            })

            $('#step-2-button').click(function () {
                var postListRef = db.ref(`articles/${params.key}/status`).set(2);

                setTimeout(function () {
                    location.href = "./articles.html"
                }, 2000)
            })

            $('#step-3-button').click(function () {
                if ($('#file-input').val()) {
                    var file = $('#file-input')[0].files[0]; // use the Blob or File API
                    var newFilename = uuidv4() + '.jpg';

                    storageRef = storage.ref();
                    storageRef.child(newFilename).put(file).then(function (snapshot) {
                        snapshot.ref.getDownloadURL().then(function (downloadURL) {
                            var postListRef = db.ref(`articles/${params.key}/status`).set(3);
                            var postListRef = db.ref(`articles/${params.key}/thumbnail-after`).set(downloadURL);

                            setTimeout(function () {
                                location.href = "./articles.html"
                            }, 2000)
                        });
                    });
                }
            })
        })

        function uuidv4() {
            return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
        }
    </script>
</head>

<body>
    <div class="container">
        <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane show active" id="pills-news" role="tabpanel" aria-labelledby="pills-news-tab">
                <div class="step-1 mb-3">
                    <div>[1단계] 게시글 등록</div>
                    <button id="step-1-button" class="btn btn-primary">업데이트</button>
                </div>
                <div class="step-2 mb-3">
                    <div>[2단계] 담당자 매칭 완료</div>
                    <button id="step-2-button" class="btn btn-primary">업데이트</button>
                </div>
                <div class="step-3">
                    <div>[3단계] 처리후 이미지 업데이트</div>
                    <input id="file-input" type="file" class="form-control">
                    <button id="step-3-button" class="btn btn-primary">업데이트</button>
                </div>
            </div>
        </div>

        <ul class="nav nav-pills tabs" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <a href="./report.html" class="nav-link" id="pills-report-tab">
                    <img src="/images/add_a_photo_black_48dp.svg" class="black">
                    제보
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="../index.html" class="nav-link " id="pills-index-tab">
                    <img src="/images/room_black_48dp.svg" class="black">
                    지도
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="./articles.html" class="nav-link" id="pills-articles-tab">
                    <img src="/images/article_black_48dp.svg" class="black">
                    현황
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="./news.html" class="nav-link" id="pills-news-tab">
                    <img src="/images/insert_chart_black_48dp.svg" class="black">
                    뉴스
                </a>
            </li>
        </ul>
    </div>
</body>

</html>
